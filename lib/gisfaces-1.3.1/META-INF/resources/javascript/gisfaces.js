/* Copyright © 2014 Geer Services Inc - All Rights Reserved */
/* GISFaces was created by Chris Duncan (chris@geerservices.com) */

if(!gisfaces){var gisfaces={};}gisfaces.processMapClick=function(_1){var _2=_1.mapPoint;gisfaces.generateJsfMapClickEvent(_2);};gisfaces.loadInfoTemplates=function(_3){var _4=_3.layerInfos;if(_4){var _5={};for(var i=0;i<_4.length;i++){var _6=_4[i];_5[_6.id]={infoTemplate:gisfaces.template};}_3.setInfoTemplates(_5);}};gisfaces.buildGenericInfoTemplateFeatureTitle=function(_7){gisfaces.setGraphicSourceProperties(_7);var _8=dojo.create("div");gisfaces.renderGraphicSymbology(_7,_8);var _9="";if(gisfaces.map.infoWindow.count!=1){_9="("+(gisfaces.map.infoWindow.selectedIndex+1)+"/"+gisfaces.map.infoWindow.count+")";}return "<table><tr><td>"+_8.innerHTML+"</td><td>"+_7.getLayer().name+"</td><td>"+_9+"</td></tr></table>";};gisfaces.buildGenericInfoTemplateContent=function(_a){gisfaces.setGraphicSourceProperties(_a);var _b="<table class='gisfacesPopupTable'>";var _c=_a.attributes;for(var _d in _c){var _e=_d;var _f=_c[_d];var _10=gisfaces.getGraphicLayerFieldAlias(_e,_a);if(_f){if(typeof _f==="string"){if(_f.toLowerCase()=="null"){_f="";}else{if(gisfaces.isImage(_f.toLowerCase())){_f="<a target='_blank' href='"+_f+"'><img height='50' src='"+_f+"'/></a>";}else{if(gisfaces.isLink(_f.toLowerCase())){_f="<a target='_blank' href='"+_f+"'>Details</a>";}}}}}else{_f="";}_b+="<tr><td width='50%'><span title='"+_e+"'>"+_10+"</span></td><td width='50%'>"+_f+"</td></tr>";}_b+="</table>";return _b;};gisfaces.setGraphicSourceProperties=function(_11){var _12=_11.getLayer();if(_12){var _13=_12.layerId;var _14=_12.id.replace(new RegExp("_"+_13+"$"),"");_11.source={};_11.source.serviceId=_14;_11.source.layerId=_13;}};gisfaces.renderGraphicSymbology=function(_15,_16){var _17=null;if(_15.symbol){_17=_15.symbol;}else{var _18=_15.getLayer();if(_18&&_18.renderer){if(_18.renderer.symbol){_17=_18.renderer.symbol;}else{_17=_18.renderer.getSymbol(_15);}}}if(_17){if(_15.source&&_15.source.serviceId){var _18=gisfaces.map.getLayer(_15.source.serviceId);if(_18&&_18.opacity&&_17.color){_17.color.a=_18.opacity;}}if(_17.url){dojo.create("img",{"src":_17.url,"style":{"maxHeight":"23px"}},_16);}else{var _19=esri.symbol.getShapeDescriptors(_17);var _1a=dojox.gfx.createSurface(_16,25,25);var _1b=_1a.createShape(_19.defaultShape).setFill(_19.fill).setStroke(_19.stroke);_1b.applyTransform({dx:12,dy:12});}}};gisfaces.getGraphicLayerFieldAlias=function(_1c,_1d){var _1e=_1c;var _1f=gisfaces.getGraphicLayerField(_1c,_1d);if(_1f){_1e=_1f.alias;}return _1e;};gisfaces.getGraphicLayerField=function(_20,_21){var _22=_21.getLayer().fields;if(_22){for(var i=0;i<_22.length;i++){var _23=_22[i];if(_20==_23.name){return _23;}}}return null;};gisfaces.addMarkerGraphic=function(_24,_25,_26,_27,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f){if(!_2a){_2a="https://js.arcgis.com/3.11/esri/dijit/GeocodeMatch/images/EsriBluePinCircle26.png";_2b=26;_2c=26;}var _30=esri.geometry.geographicToWebMercator(new esri.geometry.Point(_28,_27));var _31=new esri.symbol.PictureMarkerSymbol(_2a,_2b,_2c);_31.setAngle(_2d);var _32=new esri.Graphic(_30,_31,_29);_32.visible=_2e;_32.uuid=_25;_32.type=_26;_32.draggable=_2f;_24.add(_32);};gisfaces.hideInfoWindow=function(){if(gisfaces.map){gisfaces.map.infoWindow.hide();}};gisfaces.showProgressBar=function(){if(typeof gisfaces.loadingDiv!=="undefined"){esri.show(dojo.byId(gisfaces.loadingDiv));}};gisfaces.hideProgressBar=function(){if(typeof gisfaces.loadingDiv!=="undefined"){esri.hide(dojo.byId(gisfaces.loadingDiv));}};gisfaces.showCoordinates=function(evt,id){var _33=esri.geometry.webMercatorToGeographic(evt.mapPoint);dojo.byId(id).innerHTML=(_33.x).toFixed(12)+", "+(_33.y).toFixed(12);esri.show(dojo.byId(id));};gisfaces.hideCoordinates=function(evt,id){esri.hide(dojo.byId(id));};gisfaces.setCursor=function(_34){if(gisfaces.map){gisfaces.map.setMapCursor(_34);}};gisfaces.resetCursor=function(){gisfaces.setCursor("default");};gisfaces.resetNavigationToolbar=function(){gisfaces.selectNavigtionToolbarPan();gisfaces.map.graphics.clear();};gisfaces.selectNavigtionToolbarPan=function(){if(gisfaces.navbar){gisfaces.navbar.deactivate();}gisfaces.resetCursor();};gisfaces.selectNavigtionToolbarZoomIn=function(){if(gisfaces.navbar){gisfaces.navbar.activate(esri.toolbars.Navigation.ZOOM_IN);}gisfaces.setCursor("crosshair");};gisfaces.selectNavigtionToolbarZoomOut=function(){if(gisfaces.navbar){gisfaces.navbar.activate(esri.toolbars.Navigation.ZOOM_OUT);}gisfaces.setCursor("crosshair");};gisfaces.selectNavigtionToolbarZoomFullExtent=function(){gisfaces.setMapExtent(gisfaces.defaultLatitude,gisfaces.defaultLongitude,gisfaces.defaultZoom);};gisfaces.selectNavigtionToolbarPreviousExtent=function(){if(gisfaces.navbar){gisfaces.navbar.zoomToPrevExtent();}};gisfaces.selectNavigtionToolbarNextExtent=function(){if(gisfaces.navbar){gisfaces.navbar.zoomToNextExtent();}};gisfaces.createOverview=function(_35){if(gisfaces.overview){gisfaces.overview.destroy();}var id=dojo.create("div",{style:{position:"relative",overflow:"hidden"}},_35);gisfaces.overview=new esri.dijit.OverviewMap({map:gisfaces.map,expandFactor:5,height:150,opacity:0.25},id);gisfaces.overview.startup();};gisfaces.refreshLegend=function(id){if(gisfaces.legend){gisfaces.legend.refresh();}else{if(id){gisfaces.legend=new esri.dijit.Legend({map:gisfaces.map,respectCurrentMapScale:true},id);gisfaces.legend.startup();}}};gisfaces.refreshMapSize=function(){if(gisfaces.map){gisfaces.map.reposition();gisfaces.map.resize();}};gisfaces.refreshMapLayers=function(){if(gisfaces.map){var _36=gisfaces.map.getLayersVisibleAtScale(gisfaces.map.getScale());if(_36){for(var i=0;i<_36.length;i++){var _37=_36[i];if((_37)&&(_37.loaded)&&(_37.visible)&&(_37.refresh)){_37.refresh();}}}}};gisfaces.setBackgroundLayer=function(_38){if(_38&&gisfaces.map&&(gisfaces.map.getBasemap()!=_38)){gisfaces.map.setBasemap(_38);}};gisfaces.setMapExtent=function(_39,_3a,_3b){if(gisfaces.map&&_39&&_3a&&_3b){var _3c=gisfaces.map.extent.getCenter();if((_3c.getLatitude()!=_39)||(_3c.getLongitude()!=_3a)||(gisfaces.map.getLevel()!=_3b)){var _3d=esri.geometry.Point(_3a,_39);gisfaces.map.centerAndZoom(_3d,_3b);}}};gisfaces.hasGraphicsAndFeatureLayers=function(){var _3e=false;var _3f=false;if(gisfaces.map){var ids=gisfaces.map.graphicsLayerIds;for(var i=0;i<ids.length;i++){var id=ids[i];var _40=gisfaces.map.getLayer(id);if(_40.visible){if(_40.declaredClass==="esri.layers.GraphicsLayer"){_3e=true;}else{if(_40.declaredClass==="esri.layers.FeatureLayer"){_3f=true;}}}}}return (_3e&&_3f);};gisfaces.reorderGraphicsLayers=function(){if(gisfaces.map&&gisfaces.hasGraphicsAndFeatureLayers()){var _41=gisfaces.map.layerIds.length+gisfaces.map.graphicsLayerIds.length-1;var _42=gisfaces.map.graphicsLayerIds.slice(0);for(var i=0;i<_42.length;i++){var id=_42[i];var gl=gisfaces.map.getLayer(id);if(gl.declaredClass==="esri.layers.GraphicsLayer"){gisfaces.map.reorderLayer(gl,_41);_41++;}}}};gisfaces.generateLodLevels=function(_43){var _44=[];var _45=591657527.591555;var _46=156543.033928;for(var i=0;i<_43;i++){var lod={};lod.level=i;lod.scale=_45;lod.resolution=_46;_44.push(lod);_45/=2;_46/=2;}return _44;};gisfaces.holdGraphic=function(evt){gisfaces.hideInfoWindow();if(evt.graphic.draggable){gisfaces.logGraphicCoordinates("Graphic clicked",evt);gisfaces.map.disablePan();evt.graphic.dragging=true;evt.graphic.dragged=false;}};gisfaces.dragGraphic=function(evt){if(evt.graphic.draggable&&evt.graphic.dragging){gisfaces.logGraphicCoordinates("Graphic dragged",evt);evt.graphic.geometry=evt.mapPoint;evt.graphic.draw();evt.graphic.dragged=true;}};gisfaces.releaseGraphic=function(evt){if(evt.graphic.draggable&&evt.graphic.dragging&&evt.graphic.dragged){gisfaces.logGraphicCoordinates("Graphic released",evt);var _47=new esri.Graphic(evt.graphic.toJson());_47.uuid=evt.graphic.uuid;_47.type=evt.graphic.type;_47.draggable=evt.graphic.draggable;var _48=evt.graphic.getLayer();_48.remove(evt.graphic);_48.add(_47);gisfaces.generateJsfMapGraphicDragEvent(evt.graphic);}gisfaces.map.enablePan();evt.graphic.dragging=false;evt.graphic.dragged=false;};gisfaces.logGraphicCoordinates=function(msg,evt){var _49=esri.geometry.webMercatorToGeographic(evt.mapPoint);};gisfaces.exportPopupGraphicToHtml=function(evt){var _4a=gisfaces.map.infoWindow.getSelectedFeature();var _4b="<html><body><table border='1' style='border-collapse:collapse;'>";_4b+="<tr><th colspan='3'>"+_4a.getLayer().name+"</th></tr>";_4b+="<tr><th>Alias</th><th>Name</th><th>Value</th></tr>";for(name in _4a.attributes){var _4c=gisfaces.getGraphicLayerFieldAlias(name,_4a);var _4d=_4a.attributes[name];_4b+="<tr><td>"+_4c+"</td><td>"+name+"</td><td>"+_4d+"</td></tr>";}_4b+="</table></body></html>";var win=window.open();win.document.write(_4b);win.document.close();};gisfaces.addPopupFooterLink=function(_4e,_4f){var _50=dojo.create("a",{"class":"action","innerHTML":_4e,"href":"javascript:void(0);"},dojo.query(".actionList",gisfaces.map.infoWindow.domNode)[0]);dojo.connect(_50,"onclick",_4f);};gisfaces.getCurrentPosition=function(){if(navigator.geolocation){gisfaces.showProgressBar();navigator.geolocation.getCurrentPosition(gisfaces.processGeoLocationEvent,gisfaces.processGeoLocationError,{enableHighAccuracy:true,timeout:60000});}else{alert("Your browser does not support geo-location.");}};gisfaces.watchPosition=function(){if(navigator.geolocation){gisfaces.showProgressBar();return navigator.geolocation.watchPosition(gisfaces.processGeoLocationEvent,gisfaces.processGeoLocationError,{enableHighAccuracy:true,timeout:60000});}else{alert("Your browser does not support geo-location.");}};gisfaces.processGeoLocationEvent=function(_51){var _52=esri.geometry.geographicToWebMercator(new esri.geometry.Point(_51.coords.longitude,_51.coords.latitude));var _53=new esri.symbol.PictureMarkerSymbol("https://js.arcgis.com/3.11/esri/dijit/GeocodeMatch/images/EsriYellowPinCircle26.png",26,26);var _54={latitude:_51.coords.latitude.toFixed(12),longitude:_51.coords.longitude.toFixed(12)};var _55=new esri.InfoTemplate("<b>Geolocation</b>","<table class='gisfacesPopupTable'><tr><td><b>Longitude</b></td><td>${longitude}</td></tr><tr><td><b>Latitude</b></td><td>${latitude}</td></tr></table>");var _56=new esri.Graphic(_52,_53,_54,_55);gisfaces.map.graphics.add(_56);gisfaces.setMapExtent(_51.coords.latitude,_51.coords.longitude,16);gisfaces.generateJsfMapGeoLocationEvent(_51);};gisfaces.processGeoLocationError=function(_57){var _58;switch(_57.code){case _57.PERMISSION_DENIED:_58="User denied the request for geo-location.";break;case _57.POSITION_UNAVAILABLE:_58="Geo-location information is unavailable.";break;case _57.TIMEOUT:_58="The request to get user geo-location timed out.";break;default:_58="An unknown geo-location error occurred.";break;}alert(_58);gisfaces.hideProgressBar();};gisfaces.isLink=function(s){return (s.startsWith("http://")||s.startsWith("https://"));};gisfaces.isImage=function(s){return (gisfaces.isLink(s)&&(s.endsWith(".png")||s.endsWith(".jpg")||s.endsWith(".jpeg")||s.endsWith(".gif")||s.endsWith(".bmp")));};gisfaces.isNumeric=function(x){return ((x)&&(isFinite(x)&&!isNaN(x)));};gisfaces.getNumericValue=function(x,def){return gisfaces.isNumeric(x)?x:def;};String.prototype.startsWith=function(s){return ((s)&&(this.trim().toLowerCase().indexOf(s.trim().toLowerCase())==0));};String.prototype.endsWith=function(s){return ((s)&&(this.trim().toLowerCase().indexOf(s.trim().toLowerCase(),this.trim().length-s.trim().length)!==-1));};